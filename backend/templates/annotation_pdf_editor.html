{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pdf-editor.css') }}">

<div class="chatgpt-workspace-layout full-height-container">

  <aside class="project-history-panel chatgpt-history-card full-height-panel">
    <header class="project-header">
      <button id="backToImportBtn" class="new-project-btn primary-btn" onclick="window.location.href='/annotation'">
        <i class="fas fa-chevron-left"></i> Back to Import
      </button>
    </header>

    <div class="project-list-scroll full-height-scroll" id="annotationFolders">
      <div class="project-item active">Editing: {{ filename }}</div>
      <h3 class="panel-subtitle">Annotation Settings</h3>
      <div class="setting-item">
          <label class="scale-control">Scale (m/px): 
            <input type="number" id="scaleInput" value="0.05" step="0.01">
          </label>
      </div>
    </div>
  </aside>

  <div class="single-workspace-tile chatgpt-main-box full-height-panel">
    
    <div class="annotation-container large-chat-container">
        <h2 class="editor-title">ðŸ“„ PDF Drawing Editor â€” <span id="currentFilename">{{ filename }}</span></h2>

        <div class="editor-toolbar">
          
          <div class="toolbar-group">
            <button class="tool-btn icon-btn" id="undoBtn" title="Undo"><i class="fas fa-undo"></i></button>
            <button class="tool-btn icon-btn" id="redoBtn" title="Redo"><i class="fas fa-redo"></i></button>
          </div>
          
          <div class="toolbar-group core-tools" id="annotationTools">
            <button class="tool-btn active" data-tool="pan" title="Pan/Move"><i class="fas fa-hand-paper"></i> Pan</button>
            <button class="tool-btn" data-tool="pen" title="Free Draw"><i class="fas fa-pencil-alt"></i> Pen</button>
            <button class="tool-btn" data-tool="eraser" title="Eraser"><i class="fas fa-eraser"></i> Eraser</button>
            <button class="tool-btn" data-tool="measure" title="Measure"><i class="fas fa-ruler-combined"></i> Scale</button>
          </div>
          
          <div class="toolbar-group shape-tools">
            <button class="tool-btn" data-tool="rect" title="Draw Square/Rectangle"><i class="far fa-square"></i> Square</button>
            <button class="tool-btn" data-tool="line" title="Draw Line"><i class="fas fa-slash"></i> Line</button>
            <button class="tool-btn" data-tool="text" title="Add/Edit Text"><i class="fas fa-font"></i> Text</button>
          </div>

          <div class="toolbar-group control-tools">
            <label for="colorPicker" class="color-label" title="Select Color">
                <i class="fas fa-palette"></i>
                <input type="color" id="colorPicker" value="#5c6bc0">
            </label>
            <button id="deleteSelectedBtn" class="tool-btn delete-btn" title="Delete Selected Object"><i class="fas fa-trash"></i> Delete</button>
          </div>
          
          <div class="toolbar-group zoom-controls">
            <button class="tool-btn icon-btn" id="zoomInBtn" title="Zoom In"><i class="fas fa-search-plus"></i></button>
            <button class="tool-btn icon-btn" id="zoomOutBtn" title="Zoom Out"><i class="fas fa-search-minus"></i></button>
            <button class="tool-btn" id="fitToScreenBtn" title="Fit to Screen"><i class="fas fa-expand-arrows-alt"></i> Fit</button>
          </div>

          <button id="saveFileBtn" class="tool-btn save-btn primary-btn-3d" title="Save File Locally and Upload">
              <i class="fas fa-cloud-upload-alt"></i> Save & Upload
          </button>
        </div>
        <div class="canvas-wrapper">
          <canvas id="pdfCanvas"></canvas>
          <canvas id="overlay"></canvas>
          <p class="placeholder-text">Loading PDF for editing...</p>
        </div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
<script>
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';
  const projectId = "{{ pid }}"; // Assuming 'pid' is passed by Flask
  const pdfFilename = "{{ filename }}"; // Assuming 'filename' is passed by Flask
</script>
<script src="{{ url_for('static', filename='js/pdf-editor.js') }}" defer></script>
{% endblock %}